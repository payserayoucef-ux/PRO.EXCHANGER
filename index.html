<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>منصة ucef-ux للوثائق الإدارية الجزائرية</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        :root { --primary: #2c3e50; --secondary: #3498db; --success: #27ae60; --bg: #f8fafc; }
        body { font-family: 'Arial', sans-serif; background: var(--bg); margin: 0; padding: 0; }
        header { background: var(--primary); color: white; padding: 20px; text-align: center; border-bottom: 4px solid var(--secondary); }
        .container { max-width: 1100px; margin: 20px auto; padding: 15px; }
        
        /* شبكة الأزرار */
        .services-grid { 
            display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); 
            gap: 10px; margin-bottom: 30px; 
        }
        .btn-service { 
            background: white; border: 1px solid #ddd; padding: 12px; border-radius: 8px; 
            cursor: pointer; font-weight: bold; transition: 0.2s; font-size: 0.85rem;
        }
        .btn-service:hover { border-color: var(--secondary); background: #ebf5ff; }
        .btn-active { background: var(--secondary) !important; color: white !important; border: none; }

        /* منطقة العمل */
        .workspace { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .input-group { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
        input, textarea { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; font-family: inherit; }
        textarea { grid-column: span 2; }
        .btn-download { width: 100%; padding: 15px; background: var(--success); color: white; border: none; border-radius: 6px; font-size: 1.1rem; cursor: pointer; margin-top: 15px; font-weight: bold; }

        /* قالب PDF */
        #pdf-render { display: none; width: 800px; padding: 60px; background: white; color: black; line-height: 1.8; font-size: 14pt; position: absolute; left: -9999px; }
    </style>
</head>
<body>

<header>
    <h1>بوابة ucef-ux للوثائق الإدارية</h1>
    <p>صناعة الوثائق الجزائرية بلمسة ذكية</p>
</header>

<div class="container">
    <div class="services-grid" id="buttons-container">
        </div>

    <div class="workspace">
        <h2 id="current-title">طلب خطي</h2>
        <div id="dynamic-inputs" class="input-group">
            </div>
        <button class="btn-download" onclick="generatePDF()">تحميل الوثيقة (PDF)</button>
    </div>
</div>

<div id="pdf-render" dir="rtl">
    <div id="pdf-body"></div>
</div>

<script>
    // قاعدة بيانات النماذج الجزائرية
    const models = {
        "talab": { title: "طلب خطي", fields: ["fname", "address", "commune", "phone", "receiver", "subject", "details"], template: "لي الشرف العظيم أن أتقدم لسيادتكم بطلبي هذا والمتمثل في {subject}. {details}" },
        "sharafi": { title: "تصريح شرفي", fields: ["fname", "birth", "address", "id_card"], template: "أنا الموقع أدناه، أصرح بشرفي أنني {details}. أتحمل كامل المسؤولية القانونية في حال ثبت عكس ذلك." },
        "abawi": { title: "تصريح أبوي", fields: ["fname", "son_name", "son_birth", "destination"], template: "أنا الموقع أدناه، بصفتي ولي أمر القاصر {son_name}، أصرح أنني أرخص له بالسفر إلى {destination}." },
        "batala": { title: "طعن منحة البطالة", fields: ["fname", "phone", "reason"], template: "أتقدم بهذا الطعن بخصوص توقيف منحة البطالة الخاصة بي، محيطاً سيادتكم علماً أنني {reason}." },
        "bike": { title: "عقد بيع دراجة نارية", fields: ["fname", "buyer_name", "bike_type", "bike_serial"], template: "أصرح أنني بعت دراجتي من نوع {bike_type} رقم الهيكل {bike_serial} للسيد {buyer_name} بمبلغ متفق عليه." },
        "gaz": { title: "طلب عداد غاز", fields: ["fname", "address", "phone"], template: "أطلب من مصالحكم الموقرة تزويد سكني الكائن بالعنوان المذكور أعلاه بمرجع عداد الغاز الطبيعي." }
        // يمكن إضافة البقية بنفس الطريقة
    };

    let currentModel = "talab";

    function init() {
        const container = document.getElementById('buttons-container');
        Object.keys(models).forEach(key => {
            let btn = document.createElement('button');
            btn.className = `btn-service ${key === 'talab' ? 'btn-active' : ''}`;
            btn.innerText = models[key].title;
            btn.onclick = () => switchModel(key, btn);
            container.appendChild(btn);
        });
        switchModel('talab');
    }

    function switchModel(key, btn) {
        currentModel = key;
        document.querySelectorAll('.btn-service').forEach(b => b.classList.remove('btn-active'));
        if(btn) btn.classList.add('btn-active');
        
        document.getElementById('current-title').innerText = models[key].title;
        const inputDiv = document.getElementById('dynamic-inputs');
        inputDiv.innerHTML = "";
        
        models[key].fields.forEach(f => {
            let input = document.createElement(f === 'details' || f === 'reason' ? 'textarea' : 'input');
            input.id = `input-${f}`;
            input.placeholder = getPlaceholder(f);
            if(input.tagName === 'TEXTAREA') input.rows = 3;
            inputDiv.appendChild(input);
        });
    }

    function getPlaceholder(f) {
        const mapping = { fname: "الاسم واللقب", address: "العنوان", commune: "البلدية", phone: "رقم الهاتف", receiver: "المرسل إليه", subject: "الموضوع", details: "تفاصيل أخرى", birth: "تاريخ الميلاد", id_card: "رقم بطاقة التعريف", son_name: "اسم الابن القاصر", son_birth: "تاريخ ميلاده", destination: "جهة السفر", buyer_name: "اسم المشتري", bike_type: "نوع الدراجة", bike_serial: "رقم الهيكل", reason: "سبب الطعن" };
        return mapping[f] || f;
    }

    function generatePDF() {
        const m = models[currentModel];
        let text = m.template;
        m.fields.forEach(f => {
            const val = document.getElementById(`input-${f}`).value || "..........";
            text = text.replace(`{${f}}`, val);
        });

        const d = new Date();
        const dateStr = `${d.getFullYear()}/${String(d.getMonth()+1).padStart(2,'0')}/${String(d.getDate()).padStart(2,'0')}`;

        const html = `
            <div style="display:flex; justify-content:space-between;">
                <div>
                    <p>الاسم واللقب: ${document.getElementById('input-fname')?.value || '....'}</p>
                    <p>العنوان: ${document.getElementById('input-address')?.value || '....'}</p>
                </div>
                <div><p>اليوم: ${dateStr}</p></div>
            </div>
            <div style="text-align:center; margin-top:50px;">
                <h2 style="text-decoration:underline;">${m.title}</h2>
            </div>
            <div style="margin-top:40px; text-align:right;">
                <p style="text-indent:50px;">${text}</p>
                <p style="margin-top:30px;">تقبلوا مني فائق الاحترام والتقدير.</p>
            </div>
            <div style="margin-top:80px; text-align:left; margin-left:80px;"><strong>المعني</strong></div>
        `;

        document.getElementById('pdf-body').innerHTML = html;
        const element = document.getElementById('pdf-render');
        element.style.display = 'block';

        html2pdf().set({
            margin: 0.5, filename: `${currentModel}_ucef.pdf`,
            html2canvas: { scale: 3 }, jsPDF: { unit: 'in', format: 'a4' }
        }).from(element).save().then(() => element.style.display = 'none');
    }

    window.onload = init;
</script>
</body>
</html>

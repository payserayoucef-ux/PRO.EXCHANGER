<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>منصة ucef-ux الشاملة للوثائق</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    
    <style>
        :root { --primary: #2c3e50; --secondary: #3498db; --success: #27ae60; --bg: #f4f7f6; }
        body { font-family: 'Arial', sans-serif; background: var(--bg); margin: 0; padding: 0; text-align: right; }
        header { background: var(--primary); color: white; padding: 20px; text-align: center; border-bottom: 5px solid var(--secondary); }
        .container { max-width: 1100px; margin: 20px auto; padding: 15px; }
        
        /* شبكة الأزرار - 20 زر */
        .services-grid { 
            display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); 
            gap: 12px; margin-bottom: 30px; 
        }
        .btn-service { 
            background: white; border: 1px solid #ddd; padding: 15px; border-radius: 10px; 
            cursor: pointer; font-weight: bold; transition: 0.3s; font-size: 0.9rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .btn-service:hover { background: var(--secondary); color: white; transform: translateY(-2px); }
        .btn-active { background: var(--secondary) !important; color: white !important; border: none; }

        /* منطقة العمل */
        .workspace { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .input-group { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px; }
        input, textarea { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 6px; box-sizing: border-box; font-size: 16px; }
        textarea { grid-column: span 2; }
        .btn-download { width: 100%; padding: 18px; background: var(--success); color: white; border: none; border-radius: 8px; font-size: 1.2rem; cursor: pointer; margin-top: 20px; font-weight: bold; }

        /* منطقة الـ PDF (مخفية تقنياً لتجنب الصفحة البيضاء) */
        #pdf-export-container { position: absolute; left: -9999px; top: 0; width: 800px; }
        .pdf-page { background: white; padding: 60px; color: black; line-height: 1.8; font-size: 14pt; }
    </style>
</head>
<body>

<header>
    <h1>منصة ucef-ux للخدمات الإدارية الجزائرية</h1>
    <p>بوابتك الرقمية لاستخراج 20 نموذجاً إدارياً رسمياً</p>
</header>

<div class="container">
    <div class="services-grid" id="menu">
        </div>

    <div class="workspace">
        <h2 id="current-model-name">طلب خطي</h2>
        <div id="fields-container" class="input-group">
            </div>
        <button class="btn-download" onclick="generatePDF()">إصدار وتحميل الوثيقة PDF</button>
    </div>
</div>

<div id="pdf-export-container">
    <div id="final-template" class="pdf-page" dir="rtl">
        </div>
</div>

<script>
// قاعدة البيانات الشاملة للنماذج الإدارية الجزائرية
const docModels = {
    "talab": { name: "طلب خطي", fields: ["fname", "address", "commune", "phone", "receiver", "subject", "details"], body: "لي الشرف العظيم أن أتقدم إلى سيادتكم المحترمة بطلبي هذا والمتمثل في {subject}. \n {details}" },
    "sharafi": { name: "تصريح شرفي", fields: ["fname", "birth", "id_num", "address", "content"], body: "أنا الموقع أدناه، أصرح بشرفي وعن كامل مسؤوليتي أنني {content}. أقر بصحة المعلومات وأتحمل التبعات القانونية." },
    "abawi": { name: "تصريح أبوي", fields: ["fname", "son_name", "son_birth", "travel_to"], body: "أنا ولي أمر القاصر {son_name}، المولود بتاريخ {son_birth}، أرخص له بالسفر إلى {travel_to}." },
    "batala": { name: "طعن منحة البطالة", fields: ["fname", "phone", "commune", "reason"], body: "أتقدم بهذا الطعن الموجه لمصالحكم بخصوص وضعيتي تجاه منحة البطالة، حيث أنني {reason}." },
    "nazaa": { name: "نزاع أو فك نزاع", fields: ["fname", "other_party", "subject"], body: "أتقدم بهذا الطلب لغرض النظر في النزاع القائم بيني وبين {other_party} بخصوص {subject}." },
    "bike": { name: "عقد بيع دراجة نارية", fields: ["fname", "buyer", "bike_brand", "bike_serial"], body: "أصرح ببيعي للدراجة النارية نوع {bike_brand} رقم الهيكل {bike_serial} للسيد {buyer}." },
    "work_contract": { name: "عقد عمل", fields: ["fname", "company", "position", "salary"], body: "تم الاتفاق بين الطرفين على شغل وظيفة {position} لدى مؤسسة {company} براتب متفق عليه." },
    "pass_req": { name: "طلب رخصة مرور", fields: ["fname", "car_num", "destination"], body: "أرجو منكم منحنا رخصة مرور للمركبة رقم {car_num} المتوجهة إلى {destination}." },
    "muawaz": { name: "تصريح بالاحتياز (معوز)", fields: ["fname", "family_count", "income"], body: "أصرح بشرفي أن دخلي الشهري هو {income} وأعيل عائلة تتكون من {family_count} أفراد." },
    "jiwar": { name: "شهادة حسن الجوار", fields: ["fname", "neighbor_name"], body: "نشهد نحن جيران السيد {fname} والسيد {neighbor_name} على علاقة حسن الجوار والاحترام المتبادل." },
    "falahi": { name: "استغلال أرض فلاحية", fields: ["fname", "land_loc", "area"], body: "أصرح باستغلالي للقطعة الأرضية الفلاحية الكائنة بـ {land_loc} والتي تبلغ مساحتها {area}." },
    "marriage": { name: "تسجيل عقد زواج", fields: ["fname", "wife_name", "date"], body: "نلتمس من مصلحة الحالة المدنية تسجيل عقد الزواج المبرم بتاريخ {date} مع السيدة {wife_name}." },
    "asatida": { name: "مسابقة توظيف الأساتذة", fields: ["fname", "degree", "specialty"], body: "أتقدم بملف ترشحي لمسابقة توظيف الأساتذة بصفة صاحب شهادة {degree} تخصص {specialty}." },
    "ccp_pass": { name: "الرقم السري CCP", fields: ["fname", "ccp_num", "phone"], body: "أرجو من مصالح بريد الجزائر تزويدي بالرقم السري الخاص بحسابي البريدي رقم {ccp_num}." },
    "istikhlif": { name: "طلب استخلاف", fields: ["fname", "school", "period"], body: "أتقدم بطلبي هذا لشغل منصب استخلاف بمؤسسة {school} خلال الفترة {period}." },
    "gas": { name: "عداد غاز", fields: ["fname", "address", "phone"], body: "أطلب من مصالح سونلغاز تزويد مسكني بالعنوان المذكور بمرجع عداد الغاز الطبيعي." },
    "elect": { name: "عداد كهرباء", fields: ["fname", "address", "phone"], body: "أطلب من سيادتكم ربط مسكني الكائن بـ {address} بشبكة الكهرباء وتثبيت عداد جديد." },
    "water": { name: "عداد ماء", fields: ["fname", "address", "phone"], body: "نطلب من مصالح الجزائرية للمياه تركيب عداد وتوصيل السكن بشبكة المياه الشروب." },
    "estikila": { name: "طلب استقالة", fields: ["fname", "position", "company"], body: "يؤسفني إبلاغكم بقرار استقالتي من منصب {position} لأسباب شخصية، وشكراً لتفهمكم." },
    "tawid": { name: "طلب تعويض", fields: ["fname", "subject", "amount"], body: "أتقدم بطلب تعويض عن الأضرار الملحقة بخصوص {subject} بمبلغ تقديري {amount}." }
};

let currentKey = "talab";

// تشغيل الواجهة
function init() {
    const menu = document.getElementById('menu');
    Object.keys(docModels).forEach(key => {
        let btn = document.createElement('button');
        btn.className = "btn-service";
        btn.innerText = docModels[key].name;
        btn.onclick = () => loadModel(key, btn);
        menu.appendChild(btn);
    });
    loadModel('talab', menu.firstChild);
}

// تحميل الحقول حسب النموذج
function loadModel(key, btn) {
    currentKey = key;
    document.querySelectorAll('.btn-service').forEach(b => b.classList.remove('btn-active'));
    btn.classList.add('btn-active');
    
    document.getElementById('current-model-name').innerText = docModels[key].name;
    const container = document.getElementById('fields-container');
    container.innerHTML = "";
    
    docModels[key].fields.forEach(field => {
        let input = (field === 'details' || field === 'content' || field === 'reason') ? document.createElement('textarea') : document.createElement('input');
        input.id = "in-" + field;
        input.placeholder = getArabicName(field);
        if(input.tagName === 'TEXTAREA') input.rows = 4;
        container.appendChild(input);
    });
}

function getArabicName(f) {
    const names = { fname: "الاسم واللقب", address: "العنوان الكامل", commune: "البلدية", phone: "رقم الهاتف", receiver: "إلى الســــــــيد (الجهة المرسل إليها)", subject: "الموضوع", details: "توضيحات إضافية", birth: "تاريخ الميلاد", id_num: "رقم بطاقة التعريف", content: "مضمون التصريح", son_name: "اسم الابن", son_birth: "تاريخ ميلاد الابن", travel_to: "وجهة السفر", other_party: "الطرف الآخر", buyer: "اسم المشتري", bike_brand: "نوع الدراجة", bike_serial: "رقم الهيكل", company: "اسم المؤسسة", position: "الوظيفة", salary: "الراتب", car_num: "رقم السيارة", income: "الدخل الشهري", family_count: "عدد أفراد العائلة", neighbor_name: "اسم الجار", land_loc: "موقع الأرض", area: "المساحة", wife_name: "اسم الزوجة", date: "التاريخ المعني", degree: "الشهادة", specialty: "التخصص", ccp_num: "رقم الحساب الجاري", school: "المؤسسة التعليمية", period: "المدة", amount: "المبلغ" };
    return names[f] || f;
}

// توليد الـ PDF
function generatePDF() {
    const m = docModels[currentKey];
    let templateBody = m.body;
    
    m.fields.forEach(f => {
        const val = document.getElementById("in-" + f).value || "..................";
        templateBody = templateBody.replace(`{${f}}`, val);
    });

    const d = new Date();
    const dateFormatted = `${d.getFullYear()}/${String(d.getMonth()+1).padStart(2,'0')}/${String(d.getDate()).padStart(2,'0')}`;

    const pdfHtml = `
        <div style="display: flex; justify-content: space-between;">
            <div style="text-align: right;">
                <p>الاسم واللقب : ${document.getElementById('in-fname')?.value || '....'}</p>
                <p>العنوان : ${document.getElementById('in-address')?.value || '....'}${document.getElementById('in-commune') ? ' ، بلدية ' + document.getElementById('in-commune').value : ''}</p>
                <p>رقم الهاتف : ${document.getElementById('in-phone')?.value || '....'}</p>
            </div>
            <div style="text-align: left;">
                <p>اليوم : ${dateFormatted}</p>
            </div>
        </div>
        <div style="text-align: left; margin-top: 30px; margin-left: 50px;">
            <p style="font-size: 1.3em; font-weight: bold;">إلى الســــــــيد : ${document.getElementById('in-receiver')?.value || '..................'}</p>
        </div>
        <div style="text-align: center; margin-top: 60px;">
            <h2 style="text-decoration: underline;">${m.name}</h2>
            ${document.getElementById('in-subject') ? '<h3>الموضوع : ' + document.getElementById('in-subject').value + '</h3>' : ''}
        </div>
        <div style="margin-top: 50px; text-align: right; white-space: pre-line;">
            <p style="text-indent: 50px;">${templateBody}</p>
            <p style="text-indent: 50px; margin-top: 30px;">وفي الأخير تقبلوا مني فائق الاحترام والتقدير.</p>
        </div>
        <div style="margin-top: 100px; text-align: left; margin-left: 100px; font-weight: bold;">
            <p>المعني</p>
        </div>
    `;

    document.getElementById('final-template').innerHTML = pdfHtml;
    const element = document.getElementById('final-template');

    // إعدادات تصدير تمنع الصفحة البيضاء
    const opt = {
        margin: 0.5,
        filename: `${currentKey}_ucef_ux.pdf`,
        image: { type: 'jpeg', quality: 1 },
        html2canvas: { scale: 3, useCORS: true, letterRendering: true },
        jsPDF: { unit: 'in', format: 'a4', orientation: 'portrait' }
    };

    html2pdf().set(opt).from(element).save();
}

window.onload = init;
</script>
</body>
</html>
